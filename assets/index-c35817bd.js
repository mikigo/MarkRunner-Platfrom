var w=(D,n,o)=>new Promise((u,d)=>{var g=t=>{try{p(o.next(t))}catch(m){d(m)}},_=t=>{try{p(o.throw(t))}catch(m){d(m)}},p=t=>t.done?u(t.value):Promise.resolve(t.value).then(g,_);p((o=o.apply(D,n)).next())});import{z as c,af as P,Z as f,S as V,o as S,b as $,w as s,d as T,H as N,f as e,X as h,e as i,Y as A,ac as K,ag as O,h as b,ah as C}from"./index-d1faa2f4.js";import{_ as j}from"./CommonPage-a9d60257.js";import{_ as E}from"./QueryBarItem-7cbf7e4d.js";import{u as H,_ as L,N as M}from"./useCRUD-c23211cb.js";import{_ as X,a as Y}from"./TheIcon-57f0dddb.js";import{N as Z}from"./TreeSelect-3b26f956.js";import{N as G}from"./InputNumber-a3f9c279.js";import{N as k}from"./Input-982faeef.js";import{N as J,a as y}from"./FormItem-a09724bd.js";import"./AppPage-086a18a0.js";import"./Tree-0dc827b4.js";import"./Add-5c606f0a.js";const pe=Object.assign({name:"部门管理"},{__name:"index",setup(D){const n=c(null),o=c({}),u=P("permission"),{modalVisible:d,modalTitle:g,modalLoading:_,handleSave:p,modalForm:t,modalFormRef:m,handleEdit:I,handleDelete:q,handleAdd:z}=H({name:"API",initForm:{order:0},doCreate:f.createDept,doUpdate:f.updateDept,doDelete:f.deleteDept,refresh:()=>{var r;return(r=n.value)==null?void 0:r.handleSearch()}}),x=c([]),v=c(!1);V(()=>{var r;(r=n.value)==null||r.handleSearch(),f.getDepts().then(a=>x.value=a.data)});const F={name:[{required:!0,message:"请输入部门名称",trigger:["input","blur","change"]}]};function B(){return w(this,null,function*(){v.value=!1,z()})}const R=[{title:"部门名称",key:"name",width:"auto",align:"center",ellipsis:{tooltip:!0}},{title:"备注",key:"desc",align:"center",width:"auto",ellipsis:{tooltip:!0}},{title:"操作",key:"actions",width:"auto",align:"center",fixed:"right",render(r){return[N(b(h,{size:"small",type:"primary",style:"margin-left: 8px;",onClick:()=>{console.log("row",r.parent_id),r.parent_id===0?v.value=!0:v.value=!1,I(r)}},{default:()=>"编辑",icon:C("material-symbols:edit",{size:16})}),[[u,"post/api/v1/dept/update"]]),b(M,{onPositiveClick:()=>q({dept_id:r.id},!1),onNegativeClick:()=>{}},{trigger:()=>N(b(h,{size:"small",type:"error",style:"margin-left: 8px;"},{default:()=>"删除",icon:C("material-symbols:delete-outline",{size:16})}),[[u,"delete/api/v1/dept/delete"]]),default:()=>b("div",{},"确定删除该部门吗?")})]}}];return(r,a)=>(S(),$(j,{"show-footer":"",title:"部门列表"},{action:s(()=>[T("div",null,[N((S(),$(e(h),{class:"float-right mr-15",type:"primary",onClick:B},{default:s(()=>[i(X,{icon:"material-symbols:add",size:18,class:"mr-5"}),a[8]||(a[8]=A("新建部门 ",-1))]),_:1,__:[8]})),[[e(u),"post/api/v1/dept/create"]])])]),default:s(()=>[i(Y,{ref_key:"$table",ref:n,"query-items":o.value,"onUpdate:queryItems":a[2]||(a[2]=l=>o.value=l),columns:R,"get-data":e(f).getDepts},{queryBar:s(()=>[i(E,{label:"部门名称","label-width":80},{default:s(()=>[i(e(k),{value:o.value.name,"onUpdate:value":a[0]||(a[0]=l=>o.value.name=l),clearable:"",type:"text",placeholder:"请输入部门名称",onKeypress:a[1]||(a[1]=K(l=>{var U;return(U=n.value)==null?void 0:U.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),i(L,{visible:e(d),"onUpdate:visible":a[7]||(a[7]=l=>O(d)?d.value=l:null),title:e(g),loading:e(_),onSave:e(p)},{default:s(()=>[i(e(J),{ref_key:"modalFormRef",ref:m,"label-placement":"left","label-align":"left","label-width":80,model:e(t),rules:F},{default:s(()=>[i(e(y),{label:"父级部门",path:"parent_id"},{default:s(()=>[i(e(Z),{value:e(t).parent_id,"onUpdate:value":a[3]||(a[3]=l=>e(t).parent_id=l),options:x.value,"key-field":"id","label-field":"name",placeholder:"请选择父级部门",clearable:"","default-expand-all":"",disabled:v.value},null,8,["value","options","disabled"])]),_:1}),i(e(y),{label:"部门名称",path:"name"},{default:s(()=>[i(e(k),{value:e(t).name,"onUpdate:value":a[4]||(a[4]=l=>e(t).name=l),clearable:"",placeholder:"请输入部门名称"},null,8,["value"])]),_:1}),i(e(y),{label:"备注",path:"desc"},{default:s(()=>[i(e(k),{value:e(t).desc,"onUpdate:value":a[5]||(a[5]=l=>e(t).desc=l),type:"textarea",clearable:""},null,8,["value"])]),_:1}),i(e(y),{label:"排序",path:"order"},{default:s(()=>[i(e(G),{value:e(t).order,"onUpdate:value":a[6]||(a[6]=l=>e(t).order=l),min:"0"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"])]),_:1}))}});export{pe as default};
